"use strict";(self.webpackChunkdigihamster=self.webpackChunkdigihamster||[]).push([[769],{"./node_modules/@radix-ui/react-presence/dist/index.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{C:()=>Presence});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),_radix_ui_react_compose_refs__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@radix-ui/react-compose-refs/dist/index.mjs"),_radix_ui_react_use_layout_effect__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@radix-ui/react-use-layout-effect/dist/index.mjs");var Presence=props=>{const{present,children}=props,presence=function usePresence(present){const[node,setNode]=react__WEBPACK_IMPORTED_MODULE_0__.useState(),stylesRef=react__WEBPACK_IMPORTED_MODULE_0__.useRef({}),prevPresentRef=react__WEBPACK_IMPORTED_MODULE_0__.useRef(present),prevAnimationNameRef=react__WEBPACK_IMPORTED_MODULE_0__.useRef("none"),initialState=present?"mounted":"unmounted",[state,send]=function useStateMachine(initialState,machine){return react__WEBPACK_IMPORTED_MODULE_0__.useReducer(((state,event)=>machine[state][event]??state),initialState)}(initialState,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return react__WEBPACK_IMPORTED_MODULE_0__.useEffect((()=>{const currentAnimationName=getAnimationName(stylesRef.current);prevAnimationNameRef.current="mounted"===state?currentAnimationName:"none"}),[state]),(0,_radix_ui_react_use_layout_effect__WEBPACK_IMPORTED_MODULE_2__.N)((()=>{const styles=stylesRef.current,wasPresent=prevPresentRef.current;if(wasPresent!==present){const prevAnimationName=prevAnimationNameRef.current,currentAnimationName=getAnimationName(styles);if(present)send("MOUNT");else if("none"===currentAnimationName||"none"===styles?.display)send("UNMOUNT");else{send(wasPresent&&prevAnimationName!==currentAnimationName?"ANIMATION_OUT":"UNMOUNT")}prevPresentRef.current=present}}),[present,send]),(0,_radix_ui_react_use_layout_effect__WEBPACK_IMPORTED_MODULE_2__.N)((()=>{if(node){let timeoutId;const ownerWindow=node.ownerDocument.defaultView??window,handleAnimationEnd=event=>{const isCurrentAnimation=getAnimationName(stylesRef.current).includes(event.animationName);if(event.target===node&&isCurrentAnimation&&(send("ANIMATION_END"),!prevPresentRef.current)){const currentFillMode=node.style.animationFillMode;node.style.animationFillMode="forwards",timeoutId=ownerWindow.setTimeout((()=>{"forwards"===node.style.animationFillMode&&(node.style.animationFillMode=currentFillMode)}))}},handleAnimationStart=event=>{event.target===node&&(prevAnimationNameRef.current=getAnimationName(stylesRef.current))};return node.addEventListener("animationstart",handleAnimationStart),node.addEventListener("animationcancel",handleAnimationEnd),node.addEventListener("animationend",handleAnimationEnd),()=>{ownerWindow.clearTimeout(timeoutId),node.removeEventListener("animationstart",handleAnimationStart),node.removeEventListener("animationcancel",handleAnimationEnd),node.removeEventListener("animationend",handleAnimationEnd)}}send("ANIMATION_END")}),[node,send]),{isPresent:["mounted","unmountSuspended"].includes(state),ref:react__WEBPACK_IMPORTED_MODULE_0__.useCallback((node2=>{node2&&(stylesRef.current=getComputedStyle(node2)),setNode(node2)}),[])}}(present),child="function"==typeof children?children({present:presence.isPresent}):react__WEBPACK_IMPORTED_MODULE_0__.Children.only(children),ref=(0,_radix_ui_react_compose_refs__WEBPACK_IMPORTED_MODULE_1__.s)(presence.ref,function getElementRef(element){let getter=Object.getOwnPropertyDescriptor(element.props,"ref")?.get,mayWarn=getter&&"isReactWarning"in getter&&getter.isReactWarning;if(mayWarn)return element.ref;if(getter=Object.getOwnPropertyDescriptor(element,"ref")?.get,mayWarn=getter&&"isReactWarning"in getter&&getter.isReactWarning,mayWarn)return element.props.ref;return element.props.ref||element.ref}(child));return"function"==typeof children||presence.isPresent?react__WEBPACK_IMPORTED_MODULE_0__.cloneElement(child,{ref}):null};function getAnimationName(styles){return styles?.animationName||"none"}Presence.displayName="Presence"},"./src/app/components/CalendarEvent/CalendarEvent.stories.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Completed:()=>Completed,Default:()=>Default,__namedExportsOrder:()=>__namedExportsOrder,default:()=>CalendarEvent_stories});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),CalendarEvent_types=__webpack_require__("./src/app/components/CalendarEvent/CalendarEvent.types.ts"),utils=__webpack_require__("./src/app/components/utils/index.ts"),state_context=__webpack_require__("./src/app/utils/hooks/use-projects/state-context.ts"),TaskActions=__webpack_require__("./src/app/components/TaskActions/index.ts"),EventActions=__webpack_require__("./src/app/components/EventActions/index.ts");const CalendarEvent=({testId,event})=>{const{getProjectById}=(0,state_context.h)(),content=(0,react.useMemo)((()=>{var _getProjectById,_getProjectById_color;return"journal"===event.resource.type||"weather"===event.resource.type?null:(0,jsx_runtime.jsx)("div",{"data-testid":testId,style:{border:(0,CalendarEvent_types.TF)(event)?`2px solid ${null!==(_getProjectById_color=null===(_getProjectById=getProjectById(event.resource.task.projectId||""))||void 0===_getProjectById?void 0:_getProjectById.color)&&void 0!==_getProjectById_color?_getProjectById_color:"#000"}`:""},className:(0,utils.cn)("h-full p-1 cursor-pointer bg-[#29221f] rounded-lg hover:border hover:border-primary mt-[-1px]",event.resource.completed&&"text-muted-foreground line-through"),children:(0,jsx_runtime.jsxs)("div",{className:"italic",children:[event.title,(0,jsx_runtime.jsx)("div",{children:(0,CalendarEvent_types.NN)(event)&&event.resource.tasks.map((t=>(0,jsx_runtime.jsx)("div",{className:"text-sm mt-1 border bg-card rounded-md p-1",children:t.title},t._id)))})]})})}),[event,testId,getProjectById]);return(0,CalendarEvent_types.uX)(event)||(0,CalendarEvent_types.B3)(event)?null:(0,CalendarEvent_types.TF)(event)?(0,jsx_runtime.jsx)(TaskActions.d,{task:event.resource.task,children:content}):(0,jsx_runtime.jsx)(EventActions.y,{event,children:content})},CalendarEvent_CalendarEvent=CalendarEvent;CalendarEvent.__docgenInfo={description:"",methods:[],displayName:"CalendarEvent",props:{testId:{required:!1,tsType:{name:"string"},description:""},event:{required:!0,tsType:{name:"union",raw:"| CalendarEventEntry\n| CalendarDeadlineEntry\n| CalendarWeatherEntry\n| CalendarJournalEntry",elements:[{name:"CalendarEventEntry"},{name:"CalendarDeadlineEntry"},{name:"CalendarWeatherEntry"},{name:"CalendarJournalEntry"}]},description:""}}};const CalendarEvent_stories={title:"Calendar/CalendarEvent",component:CalendarEvent_CalendarEvent,tags:["autodocs"]},Default={args:{event:{allDay:!1,title:"New Event",start:new Date,end:new Date,resource:{id:"event1",completed:!1,type:"event",tasks:[]}}}},Completed={args:{event:{allDay:!1,title:"New Event",start:new Date,end:new Date,resource:{id:"event1",completed:!0,type:"event",tasks:[]}}}},__namedExportsOrder=["Default","Completed"];Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:"{\n  args: defaultArgs\n}",...Default.parameters?.docs?.source}}},Completed.parameters={...Completed.parameters,docs:{...Completed.parameters?.docs,source:{originalSource:"{\n  args: completedArgs\n}",...Completed.parameters?.docs?.source}}}},"./src/app/components/CalendarEvent/CalendarEvent.types.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function isCalendarEventEntry(event){return"event"===event.resource.type}function isCalendarDeadlineEntry(event){return"deadline"===event.resource.type}function isCalendarWeatherEntry(event){return"weather"===event.resource.type}function isCalendarJournalEntry(event){return"journal"===event.resource.type}__webpack_require__.d(__webpack_exports__,{B3:()=>isCalendarWeatherEntry,NN:()=>isCalendarEventEntry,TF:()=>isCalendarDeadlineEntry,uX:()=>isCalendarJournalEntry})},"./src/app/components/EventActions/index.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{y:()=>EventActions});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),context_menu=__webpack_require__("./src/app/components/ui/context-menu.tsx"),actions_context=__webpack_require__("./src/app/utils/hooks/use-events/actions-context.tsx"),sheet=__webpack_require__("./src/app/components/ui/sheet.tsx"),EventForm=__webpack_require__("./src/app/components/EventForm/index.ts");const EventActions=({event,children})=>{const{delete:deleteEvent,update:updateEvent}=(0,actions_context.S)(),[eventFormOpen,setEventFormOpen]=(0,react.useState)(!1);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(sheet.cj,{open:eventFormOpen,children:(0,jsx_runtime.jsx)(sheet.h,{side:"left",onCloseClick:()=>setEventFormOpen(!1),onEscapeKeyDown:()=>setEventFormOpen(!1),children:(0,jsx_runtime.jsxs)(sheet.Fm,{children:[(0,jsx_runtime.jsx)(sheet.qp,{children:"Edit Event"}),(0,jsx_runtime.jsx)(sheet.Qs,{children:(0,jsx_runtime.jsx)(EventForm.A,{testId:"CalendarEvent-task-form-test-id",editMode:!0,event:{_id:event.resource.id,title:event.title,description:event.resource.description||"",completed:event.resource.completed||!1,deleted:!1,projectId:event.resource.projectId||"",allDay:event.allDay||!1,startAt:event.start.valueOf(),endAt:(event.end||0).valueOf(),tags:[],updatedAt:""},onDone:()=>setEventFormOpen(!1)})})]})})}),(0,jsx_runtime.jsxs)(context_menu.tz,{children:[(0,jsx_runtime.jsx)(context_menu.Rc,{children}),(0,jsx_runtime.jsxs)(context_menu.Ip,{className:"w-64",children:[(0,jsx_runtime.jsx)(context_menu.kt,{inset:!0,onClick:async()=>{deleteEvent(event.resource.id)},children:"Delete"}),!event.resource.completed&&(0,jsx_runtime.jsx)(context_menu.kt,{inset:!0,onClick:()=>{updateEvent(event.resource.id,{completed:!0})},children:"Complete"}),(0,jsx_runtime.jsx)(context_menu.kt,{inset:!0,onClick:()=>setEventFormOpen(!0),children:"Edit"})]})]})]})};EventActions.__docgenInfo={description:"",methods:[],displayName:"EventActions",props:{event:{required:!0,tsType:{name:"CalendarEventEntry"},description:""},children:{required:!0,tsType:{name:"ReactNode"},description:""}}}},"./src/app/components/EventForm/index.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>EventForm_EventForm});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),zod=__webpack_require__("./node_modules/@hookform/resolvers/zod/dist/zod.mjs"),lib=__webpack_require__("./node_modules/zod/lib/index.mjs"),index_esm=__webpack_require__("./node_modules/react-hook-form/dist/index.esm.mjs"),ui_form=__webpack_require__("./src/app/components/ui/form.tsx"),input=__webpack_require__("./src/app/components/ui/input.tsx"),ui_select=__webpack_require__("./src/app/components/ui/select.tsx"),ui_button=__webpack_require__("./src/app/components/ui/button.tsx"),ui_textarea=__webpack_require__("./src/app/components/ui/textarea.tsx"),actions_context=__webpack_require__("./src/app/utils/hooks/use-events/actions-context.tsx"),state_context=__webpack_require__("./src/app/utils/hooks/use-projects/state-context.ts");const FormSchema=lib.z.object({title:lib.z.string().min(1,{message:"This field has to be filled."}),description:lib.z.string(),project:lib.z.string().min(1,{message:"This field has to be filled."}),startAt:lib.z.number(),endAt:lib.z.number(),allDay:lib.z.boolean()}),EventForm=({testId,onDone,...restProps})=>{const{data:projects,defaultProject}=(0,state_context.h)(),{create:createEvent,update:updateEvent}=(0,actions_context.S)(),getInitialValues=(0,react.useCallback)((()=>restProps.editMode?{title:restProps.event.title,description:restProps.event.description||"",project:restProps.event.projectId||(null==defaultProject?void 0:defaultProject._id),allDay:restProps.event.allDay,startAt:restProps.event.startAt,endAt:restProps.event.endAt}:restProps.initialValues),[defaultProject,restProps]),form=(0,index_esm.mN)({resolver:(0,zod.u)(FormSchema),defaultValues:{title:"",description:"",project:null==defaultProject?void 0:defaultProject._id,allDay:!1,...getInitialValues()}});return(0,jsx_runtime.jsx)("div",{"data-testid":testId,children:(0,jsx_runtime.jsx)(ui_form.lV,{...form,children:(0,jsx_runtime.jsxs)("form",{onSubmit:form.handleSubmit((async data=>{if(restProps.editMode)return void updateEvent(restProps.event._id,{title:data.title,description:data.description,projectId:data.project},onDone);const eventData={title:data.title,description:data.description,projectId:data.project,allDay:data.allDay,startAt:data.startAt,endAt:data.endAt};createEvent(eventData,onDone)})),className:"space-y-6",children:[(0,jsx_runtime.jsx)(ui_form.zB,{control:form.control,name:"title",render:({field})=>(0,jsx_runtime.jsxs)(ui_form.eI,{children:[(0,jsx_runtime.jsx)(ui_form.lR,{children:"Title"}),(0,jsx_runtime.jsx)(ui_form.MJ,{children:(0,jsx_runtime.jsx)(input.p,{autoFocus:!0,placeholder:"Title",...field})}),(0,jsx_runtime.jsx)(ui_form.C5,{})]})}),(0,jsx_runtime.jsx)(ui_form.zB,{control:form.control,name:"project",render:({field})=>(0,jsx_runtime.jsxs)(ui_form.eI,{children:[(0,jsx_runtime.jsx)(ui_form.lR,{children:"Project"}),(0,jsx_runtime.jsxs)(ui_select.l6,{onValueChange:field.onChange,defaultValue:field.value,value:field.value,children:[(0,jsx_runtime.jsx)(ui_form.MJ,{children:(0,jsx_runtime.jsx)(ui_select.bq,{children:(0,jsx_runtime.jsx)(ui_select.yv,{placeholder:"Select Project"})})}),(0,jsx_runtime.jsx)(ui_select.gC,{children:projects.map((project=>(0,jsx_runtime.jsx)(ui_select.eb,{value:project._id,role:"option",children:project.title},project._id)))})]}),(0,jsx_runtime.jsx)(ui_form.C5,{})]})}),(0,jsx_runtime.jsx)(ui_form.zB,{control:form.control,name:"description",render:({field})=>(0,jsx_runtime.jsxs)(ui_form.eI,{children:[(0,jsx_runtime.jsx)(ui_form.lR,{children:"Description"}),(0,jsx_runtime.jsx)(ui_form.MJ,{children:(0,jsx_runtime.jsx)(ui_textarea.T,{placeholder:"description",...field})}),(0,jsx_runtime.jsx)(ui_form.C5,{})]})}),(0,jsx_runtime.jsx)(ui_button.$,{type:"submit",children:restProps.editMode?"Save":"Create"})]})})})},EventForm_EventForm=EventForm;EventForm.__docgenInfo={description:"",methods:[],displayName:"EventForm"}},"./src/app/components/TaskActions/index.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{d:()=>TaskActions});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),context_menu=__webpack_require__("./src/app/components/ui/context-menu.tsx"),use_edit_task=__webpack_require__("./src/app/utils/hooks/use-edit-task.tsx"),sheet=__webpack_require__("./src/app/components/ui/sheet.tsx"),RichTextEditor=__webpack_require__("./src/app/components/RichTextEditor/index.ts"),rte_hook=__webpack_require__("./src/app/utils/rte/rte-hook.ts"),ui_button=__webpack_require__("./src/app/components/ui/button.tsx");const DEFAULT_NOTES_ACTIONS={create:()=>{},update:()=>{},delete:()=>{}},NotesActionsContext=(0,react.createContext)(DEFAULT_NOTES_ACTIONS),NoteForm=({testId,onDone,parentTaskId:primaryTaskId})=>{const[loading,setLoading]=(0,react.useState)(!1),{create}=(0,react.useContext)(NotesActionsContext),{editor,getRteValue}=(0,rte_hook.P)({value:"",editable:!0});if(!editor)return null;const handleSubmit=async()=>{const{title,textContent,tags,contentJSON}=getRteValue();setLoading(!0),create({title,note:textContent||"(no content)",jsonNote:contentJSON,tags,parentTaskId:primaryTaskId}),null==editor||editor.commands.setContent(""),setLoading(!1),onDone()},submitButtonDisabled=!(null==editor?void 0:editor.getHTML().length)||"<p></p>"===(null==editor?void 0:editor.getHTML());return(0,jsx_runtime.jsxs)("div",{"data-testid":testId,children:[(0,jsx_runtime.jsx)(RichTextEditor.A,{testId:"rte-testId",editor,onKeyDown:event=>{"Enter"===event.key&&event.ctrlKey&&handleSubmit()}}),(0,jsx_runtime.jsx)(ui_button.$,{disabled:submitButtonDisabled||loading,onClick:handleSubmit,className:"mt-4",children:"Create"})]})},NoteForm_NoteForm=NoteForm;NoteForm.__docgenInfo={description:"",methods:[],displayName:"NoteForm",props:{testId:{required:!1,tsType:{name:"string"},description:""},parentTaskId:{required:!1,tsType:{name:"string"},description:""}}};var TaskFormModal=__webpack_require__("./src/app/components/TaskFormModal/index.ts");const TaskActions=({children,task})=>{const[addNoteFormOpen,setAddNoteFormOpen]=(0,react.useState)(!1),[taskFormOpen,setTaskFormOpen]=(0,react.useState)(!1),{editTask}=(0,use_edit_task.A)(),closeTaskForm=()=>setTaskFormOpen(!1);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(sheet.cj,{open:addNoteFormOpen,children:(0,jsx_runtime.jsxs)(sheet.h,{side:"right",onCloseClick:()=>setAddNoteFormOpen(!1),showOverlay:!1,onEscapeKeyDown:()=>setAddNoteFormOpen(!1),children:[(0,jsx_runtime.jsx)(sheet.Fm,{children:(0,jsx_runtime.jsx)(sheet.qp,{children:"Add note"})}),(0,jsx_runtime.jsx)(NoteForm_NoteForm,{onDone:()=>setAddNoteFormOpen(!1),parentTaskId:task._id})]})}),(0,jsx_runtime.jsx)(TaskFormModal.A,{editMode:!0,open:taskFormOpen,onDone:closeTaskForm,onClose:closeTaskForm,task}),(0,jsx_runtime.jsxs)(context_menu.tz,{children:[(0,jsx_runtime.jsx)(context_menu.Rc,{children}),(0,jsx_runtime.jsxs)(context_menu.Ip,{className:"w-64",children:[(0,jsx_runtime.jsx)(context_menu.kt,{inset:!0,onClick:()=>setAddNoteFormOpen(!0),children:"Add note"}),task.completed&&(0,jsx_runtime.jsx)(context_menu.kt,{inset:!0,onClick:()=>editTask(task._id,{completed:!1},(()=>setTaskFormOpen(!1))),children:"Undo"}),!task.completed&&(0,jsx_runtime.jsx)(context_menu.kt,{inset:!0,onClick:()=>editTask(task._id,{completed:!0},(()=>setTaskFormOpen(!1))),children:"Complete"}),!task.eventId&&task.isActive&&(0,jsx_runtime.jsx)(context_menu.kt,{inset:!0,onClick:()=>editTask(task._id,{isActive:!1},(()=>setTaskFormOpen(!1))),children:"Deactivate"}),!task.eventId&&!task.isActive&&(0,jsx_runtime.jsx)(context_menu.kt,{inset:!0,onClick:()=>editTask(task._id,{isActive:!0},(()=>setTaskFormOpen(!1))),children:"Activate"}),(0,jsx_runtime.jsx)(context_menu.kt,{inset:!0,onClick:()=>setTaskFormOpen(!0),children:"Edit"}),!!task.eventId&&(0,jsx_runtime.jsx)(context_menu.kt,{inset:!0,onClick:()=>editTask(task._id,{eventId:null}),children:"Remove from event"})]})]})]})};TaskActions.__docgenInfo={description:"",methods:[],displayName:"TaskActions",props:{children:{required:!0,tsType:{name:"ReactNode"},description:""},task:{required:!0,tsType:{name:"intersection",raw:"TaskV2 & {\n  relatedTaskIds: string[];\n  relatedNoteIds: string[];\n}",elements:[{name:"TaskV2"},{name:"signature",type:"object",raw:"{\n  relatedTaskIds: string[];\n  relatedNoteIds: string[];\n}",signature:{properties:[{key:"relatedTaskIds",value:{name:"Array",elements:[{name:"string"}],raw:"string[]",required:!0}},{key:"relatedNoteIds",value:{name:"Array",elements:[{name:"string"}],raw:"string[]",required:!0}}]}}]},description:""}}}},"./src/app/utils/hooks/use-events/actions-context.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{S:()=>useEventsActions});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js");const DEFAULT_EVENTS_ACTIONS={create:()=>{},update:()=>{},delete:()=>{}},EventsActionsContext=(0,react__WEBPACK_IMPORTED_MODULE_0__.createContext)(DEFAULT_EVENTS_ACTIONS),useEventsActions=()=>(0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(EventsActionsContext)}}]);