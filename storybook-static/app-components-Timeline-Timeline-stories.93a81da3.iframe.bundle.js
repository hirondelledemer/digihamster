"use strict";(self.webpackChunkdigihamster=self.webpackChunkdigihamster||[]).push([[573],{"./src/app/components/Timeline/Timeline.stories.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,__namedExportsOrder:()=>__namedExportsOrder,default:()=>Timeline_stories});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),use_tasks=__webpack_require__("./src/app/utils/hooks/use-tasks.tsx"),use_entry=__webpack_require__("./src/app/utils/hooks/use-entry.tsx"),endOfWeek=__webpack_require__("./node_modules/date-fns/endOfWeek.mjs"),startOfWeek=__webpack_require__("./node_modules/date-fns/startOfWeek.mjs"),sub=__webpack_require__("./node_modules/date-fns/sub.mjs"),isBefore=__webpack_require__("./node_modules/date-fns/isBefore.mjs"),isAfter=__webpack_require__("./node_modules/date-fns/isAfter.mjs"),eachDayOfInterval=__webpack_require__("./node_modules/date-fns/eachDayOfInterval.mjs"),isSameDay=__webpack_require__("./node_modules/date-fns/isSameDay.mjs"),format=__webpack_require__("./node_modules/date-fns/format.mjs"),startOfDay=__webpack_require__("./node_modules/date-fns/startOfDay.mjs"),getWeek=__webpack_require__("./node_modules/date-fns/getWeek.mjs"),date_mock=__webpack_require__("./src/app/utils/date/date.mock.ts"),sortBy=__webpack_require__("./node_modules/remeda/dist/es/sortBy.js"),MinimalNote=__webpack_require__("./src/app/components/MinimalNote/index.ts"),IconCircleCheck=__webpack_require__("./node_modules/@tabler/icons-react/dist/esm/icons/IconCircleCheck.mjs"),IconCalendarCheck=__webpack_require__("./node_modules/@tabler/icons-react/dist/esm/icons/IconCalendarCheck.mjs"),IconCalendarCancel=__webpack_require__("./node_modules/@tabler/icons-react/dist/esm/icons/IconCalendarCancel.mjs"),differenceInHours=__webpack_require__("./node_modules/date-fns/differenceInHours.mjs");const getProjectPercentages=(tasks,allProjects,events)=>{const projects=tasks.map((task=>task.projectId||"")),uniqueProjects=projects.filter(((projectId,index)=>projects.indexOf(projectId)===index)),eventsCompleteTime=events.reduce(((acc,val)=>acc+(0,differenceInHours.M)(val.endAt,val.startAt)),0),totalEstimate=tasks.reduce(((totalEstimate,currentTask)=>totalEstimate+(currentTask.estimate||0)),0)+eventsCompleteTime,projectObj={events:{percentage:eventsCompleteTime/totalEstimate*100,estimate:eventsCompleteTime,color:"#e23670",label:"Meetings"}};return uniqueProjects.reduce(((obj,projectId)=>{var _allProjects_find,_allProjects_find1;const eta=tasks.filter((task=>task.projectId===projectId)).reduce(((totalEstimate,currentTask)=>totalEstimate+(currentTask.estimate||0)),0);return{...obj,[projectId]:{percentage:eta/totalEstimate*100,estimate:eta,label:null===(_allProjects_find=allProjects.find((project=>project._id===projectId)))||void 0===_allProjects_find?void 0:_allProjects_find.title,color:null===(_allProjects_find1=allProjects.find((project=>project._id===projectId)))||void 0===_allProjects_find1?void 0:_allProjects_find1.color}}}),projectObj)};function isTask(entry){return void 0!==entry.deadline}function isEvent(entry){return void 0!==entry.startAt}var estimates=__webpack_require__("./src/app/utils/tasks/estimates.ts"),PercentagesBar=__webpack_require__("./src/app/components/PercentagesBar/index.ts"),toggle_group=__webpack_require__("./src/app/components/ui/toggle-group.tsx"),TimelineChart=__webpack_require__("./src/app/components/TimelineChart/index.ts");const DEFAULT_EVENTS_STATE={data:[],isLoading:!1,errorMessage:void 0},EventsStateContext=(0,react.createContext)(DEFAULT_EVENTS_STATE);var state_context=__webpack_require__("./src/app/utils/hooks/use-projects/state-context.ts");const Timeline=({testId})=>{const{data:tasks}=(0,use_tasks.Ay)(),{data:events}=(0,react.useContext)(EventsStateContext),{data:journalEntries}=(0,use_entry.Ay)(),{data:projects}=(0,state_context.h)(),[period,setPeriod]=(0,react.useState)("this_week"),endOfThisWeek=(0,endOfWeek.$)((0,date_mock.t)(),{weekStartsOn:1}),startDate=(0,react.useMemo)((()=>"last_week"===period?(0,startOfWeek.k)((0,sub.j)((0,date_mock.t)(),{weeks:1}),{weekStartsOn:1}):"last_2_weeks"===period?(0,startOfWeek.k)((0,sub.j)((0,date_mock.t)(),{weeks:2}),{weekStartsOn:1}):"month"===period?(0,sub.j)((0,date_mock.t)(),{months:1}):(0,startOfWeek.k)((0,date_mock.t)(),{weekStartsOn:1})),[period]),endDate=(0,isBefore.Y)((0,date_mock.t)(),endOfThisWeek)?(0,date_mock.t)():endOfThisWeek,filteredTasks=tasks.filter((task=>task.completedAt&&(0,isAfter.d)(task.completedAt,startDate)&&(0,isBefore.Y)(task.completedAt,endDate))),filteredEvents=events.filter((event=>(0,isAfter.d)(event.startAt,startDate)&&(0,isBefore.Y)(event.startAt,endDate))),filteredEntries=journalEntries.filter((entry=>(0,isAfter.d)(entry.updatedAt,startDate)&&(0,isBefore.Y)(entry.updatedAt,endDate))),logEvents=[...filteredTasks,...filteredEntries,...filteredEvents],sortedEvents=(0,sortBy.U)(logEvents,[val=>isEvent(val)?new Date(val.startAt).getTime():isTask(val)?new Date(val.completedAt||0).getTime():new Date(val.updatedAt).getTime(),"asc"]),projectPercentages=getProjectPercentages(filteredTasks,projects,filteredEvents),getCompletedTasksCount=(0,react.useCallback)((projectId=>filteredTasks.filter((t=>!projectId||t.projectId===projectId)).reduce(estimates.X,0)),[filteredTasks]),chartData=(0,react.useMemo)((()=>(0,eachDayOfInterval.k)({start:startDate,end:endDate}).map((date=>{const pp=getProjectPercentages(tasks.filter((t=>t.completedAt&&(0,isSameDay.r)(date,t.completedAt))),projects,events.filter((e=>(0,isSameDay.r)(e.startAt,date)))),newObj=Object.fromEntries(Object.entries(pp).map((([k,v])=>[k,v.estimate])));return{day:(0,format.GP)(date,"dd, E"),scrollToValue:(0,startOfDay.o)(date||0).valueOf(),...newObj}}))),[endDate,events,projects,startDate,tasks]);return(0,jsx_runtime.jsxs)("div",{"data-testid":testId,className:"p-4",children:["This week (",(0,getWeek.N)((0,date_mock.t)()),"):",(0,jsx_runtime.jsxs)(toggle_group.O,{type:"single",className:"justify-start",value:period,onValueChange:value=>{setPeriod(value)},children:[(0,jsx_runtime.jsx)(toggle_group.d,{value:"this_week",children:"This week"}),(0,jsx_runtime.jsx)(toggle_group.d,{value:"last_week",children:"Last week"}),(0,jsx_runtime.jsx)(toggle_group.d,{value:"last_2_weeks",children:"Last 2 weeks"}),(0,jsx_runtime.jsx)(toggle_group.d,{value:"month",children:"Month"})]}),(0,jsx_runtime.jsx)("div",{className:"h-[200px] mb-2 mt-2",children:(0,jsx_runtime.jsx)(TimelineChart.A,{chartConfig:projectPercentages,chartData})}),(0,jsx_runtime.jsxs)("div",{className:"space-y-1",children:[(0,jsx_runtime.jsx)(PercentagesBar.A,{data:projectPercentages}),(0,jsx_runtime.jsxs)("div",{className:"flex space-x-2",children:[(0,jsx_runtime.jsxs)("div",{className:"text-sm flex items-center mb-3 space-x-2",children:[(0,jsx_runtime.jsx)(IconCircleCheck.A,{size:19,color:"black",fill:"green",className:"mr-1"}),getCompletedTasksCount()]}),Object.keys(projectPercentages).map((projectId=>(0,jsx_runtime.jsxs)("div",{className:"text-sm flex items-center mb-3 space-x-2",children:[(0,jsx_runtime.jsx)(IconCircleCheck.A,{size:19,color:"black",fill:projectPercentages[projectId].color,className:"mr-1"}),projectPercentages[projectId].estimate]},projectId)))]}),sortedEvents.map((val=>{return isEvent(val)?(0,jsx_runtime.jsxs)("div",{className:"flex items-center","data-testid":"event-entry",id:`${(0,startOfDay.o)(val.startAt||0).valueOf()}`,children:[getDate(val.startAt),(0,jsx_runtime.jsx)("div",{className:"basis-[3%]",children:val.completed?(0,jsx_runtime.jsx)(IconCalendarCheck.A,{color:"green",size:18}):(0,jsx_runtime.jsx)(IconCalendarCancel.A,{color:"red",size:18})}),(0,jsx_runtime.jsx)("div",{children:val.title})]},val._id):isTask(val)?(0,jsx_runtime.jsxs)("div",{"data-testid":"task-entry",className:"flex items-center",id:`${(0,startOfDay.o)(val.completedAt||0).valueOf()}`,children:[getDate(val.completedAt),(0,jsx_runtime.jsx)("div",{className:"basis-[3%]",children:(0,jsx_runtime.jsx)(IconCircleCheck.A,{size:19,color:"black",fill:null===(_projects_find=projects.find((p=>p._id===val.projectId)))||void 0===_projects_find?void 0:_projects_find.color})}),(0,jsx_runtime.jsx)("div",{children:val.title})]},val._id):function isJournalEntry(entry){return void 0!==entry.note}(val)?(0,jsx_runtime.jsxs)("div",{className:"flex","data-testid":"journal-entry",id:`${(0,startOfDay.o)(val.updatedAt||0).valueOf()}`,children:[getDate(val.updatedAt),(0,jsx_runtime.jsx)("div",{className:"w-[90%]",children:(0,jsx_runtime.jsx)(MinimalNote.A,{note:val.note})})]},val._id):null;var _projects_find}))]})]})};function getDate(date){return(0,jsx_runtime.jsx)("div",{className:"basis-[10%]",children:(0,format.GP)(new Date(date||0).getTime(),"EEEEEE, HH:mm")})}const Timeline_Timeline=Timeline;Timeline.__docgenInfo={description:"",methods:[],displayName:"Timeline",props:{testId:{required:!1,tsType:{name:"string"},description:""}}};const TODAY_DATE=new Date("2024-02-14"),Timeline_stories={title:"Timeline/Timeline",component:Timeline_Timeline,tags:["autodocs"]},Default={async beforeEach(){date_mock.t.mockReturnValue(TODAY_DATE)},args:{}},__namedExportsOrder=["Default"];Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:"{\n  async beforeEach() {\n    now.mockReturnValue(TODAY_DATE);\n  },\n  args: defaultArgs\n}",...Default.parameters?.docs?.source}}}},"./src/app/components/MinimalNote/index.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>MinimalNote_MinimalNote});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),RichTextEditor=__webpack_require__("./src/app/components/RichTextEditor/index.ts"),rte_hook=__webpack_require__("./src/app/utils/rte/rte-hook.ts"),use_toast=__webpack_require__("./src/app/components/ui/use-toast.ts");function isEditable(restProps){return restProps.editable}const MinimalNote=({testId,note,...restProps})=>{const editable=!!isEditable(restProps)&&restProps.editable,forForm=!!isEditable(restProps)&&restProps.forForm,{toast}=(0,use_toast.dj)(),{editor}=(0,rte_hook.P)({value:note,editable});if((0,react.useEffect)((()=>{null==editor||editor.setEditable(editable),editable&&!forForm&&(null==editor||editor.commands.focus("end"))}),[editor,editable,forForm]),!editor)return null;return(0,jsx_runtime.jsx)(RichTextEditor.A,{testId,editor,onKeyDown:event=>{editor||toast({title:"Error",description:"Cannot submit the note: Editor not found"}),"Enter"===event.key&&event.ctrlKey&&isEditable(restProps)&&(restProps.onSubmit(null==editor?void 0:editor.getHTML()),toast({title:"Success",description:"Note submitted"}))}})},MinimalNote_MinimalNote=MinimalNote;MinimalNote.__docgenInfo={description:"",methods:[],displayName:"MinimalNote"}},"./src/app/components/PercentagesBar/index.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>PercentagesBar_PercentagesBar});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),tooltip=(__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),__webpack_require__("./src/app/components/ui/tooltip.tsx"));const PercentagesBar=({testId,data})=>(0,jsx_runtime.jsx)("div",{"data-testid":testId,className:"h-5 flex",children:Object.keys(data).map((key=>(0,jsx_runtime.jsx)(tooltip.Bc,{children:(0,jsx_runtime.jsxs)(tooltip.m_,{children:[(0,jsx_runtime.jsx)(tooltip.k$,{style:{width:`${data[key].percentage}%`},className:"hover:border-color-transparent hover:border-2",children:(0,jsx_runtime.jsx)("div",{style:{height:"100%",width:"100%",backgroundColor:`${data[key].color}`}})}),(0,jsx_runtime.jsx)(tooltip.ZI,{children:data[key].label})]})},key)))}),PercentagesBar_PercentagesBar=PercentagesBar;PercentagesBar.__docgenInfo={description:"",methods:[],displayName:"PercentagesBar",props:{testId:{required:!1,tsType:{name:"string"},description:""},data:{required:!0,tsType:{name:"PercentagesData"},description:""}}}},"./src/app/components/ui/toggle-group.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{O:()=>ToggleGroup,d:()=>ToggleGroupItem});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),dist=__webpack_require__("./node_modules/@radix-ui/react-toggle-group/dist/index.mjs"),utils=__webpack_require__("./src/app/components/utils/index.ts"),react_toggle_dist=__webpack_require__("./node_modules/@radix-ui/react-toggle/dist/index.mjs");const toggleVariants=(0,__webpack_require__("./node_modules/class-variance-authority/dist/index.mjs").F)("inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent shadow-sm hover:bg-accent hover:text-accent-foreground"},size:{default:"h-9 px-3",sm:"h-8 px-2",lg:"h-10 px-3"}},defaultVariants:{variant:"default",size:"default"}}),Toggle=react.forwardRef((({className,variant,size,...props},ref)=>(0,jsx_runtime.jsx)(react_toggle_dist.b,{ref,className:(0,utils.cn)(toggleVariants({variant,size,className})),...props})));Toggle.displayName=react_toggle_dist.b.displayName,Toggle.__docgenInfo={description:"",methods:[]};const ToggleGroupContext=react.createContext({size:"default",variant:"default"}),ToggleGroup=react.forwardRef((({className,variant,size,children,...props},ref)=>(0,jsx_runtime.jsx)(dist.bL,{ref,className:(0,utils.cn)("flex items-center justify-center gap-1",className),...props,children:(0,jsx_runtime.jsx)(ToggleGroupContext.Provider,{value:{variant,size},children})})));ToggleGroup.displayName=dist.bL.displayName;const ToggleGroupItem=react.forwardRef((({className,children,variant,size,...props},ref)=>{const context=react.useContext(ToggleGroupContext);return(0,jsx_runtime.jsx)(dist.q7,{ref,className:(0,utils.cn)(toggleVariants({variant:context.variant||variant,size:context.size||size}),className),...props,children})}));ToggleGroupItem.displayName=dist.q7.displayName,ToggleGroup.__docgenInfo={description:"",methods:[]},ToggleGroupItem.__docgenInfo={description:"",methods:[]}},"./src/app/components/ui/tooltip.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Bc:()=>TooltipProvider,ZI:()=>TooltipContent,k$:()=>TooltipTrigger,m_:()=>Tooltip});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),_radix_ui_react_tooltip__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@radix-ui/react-tooltip/dist/index.mjs"),_app_components_utils__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/app/components/utils/index.ts");const TooltipProvider=_radix_ui_react_tooltip__WEBPACK_IMPORTED_MODULE_2__.Kq,Tooltip=_radix_ui_react_tooltip__WEBPACK_IMPORTED_MODULE_2__.bL,TooltipTrigger=_radix_ui_react_tooltip__WEBPACK_IMPORTED_MODULE_2__.l9,TooltipContent=react__WEBPACK_IMPORTED_MODULE_1__.forwardRef((({className,sideOffset=4,...props},ref)=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_radix_ui_react_tooltip__WEBPACK_IMPORTED_MODULE_2__.UC,{ref,sideOffset,className:(0,_app_components_utils__WEBPACK_IMPORTED_MODULE_3__.cn)("z-50 overflow-hidden rounded-md bg-secondary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",className),...props})));TooltipContent.displayName=_radix_ui_react_tooltip__WEBPACK_IMPORTED_MODULE_2__.UC.displayName,TooltipContent.__docgenInfo={description:"",methods:[],props:{sideOffset:{defaultValue:{value:"4",computed:!1},required:!1}}}},"./src/app/utils/date/date.mock.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{t:()=>now});var _storybook_test__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@storybook/test/dist/index.mjs"),_date__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/app/utils/date/date.ts");const now=(0,_storybook_test__WEBPACK_IMPORTED_MODULE_0__.fn)(_date__WEBPACK_IMPORTED_MODULE_1__.tB).mockName("now")},"./src/app/utils/date/date.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{k0:()=>getTimestampsFrom,rZ:()=>getTodayWithZeroHours,tB:()=>now});var _barrel_optimize_names_subDays_date_fns__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/date-fns/subDays.mjs");const now=()=>new Date,getTodayWithZeroHours=()=>{const today=now();return today.setHours(0,0,0,0),today},getTimestampsFrom=(startingDate,howMany)=>{const array=[];for(let i=0;i<=howMany;i++)array.push((0,_barrel_optimize_names_subDays_date_fns__WEBPACK_IMPORTED_MODULE_0__.e)(startingDate,i).getTime());return array.reverse()}},"./src/app/utils/hooks/use-entry.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Ay:()=>useJournalEntries});__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js");var react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js");__webpack_require__("./node_modules/axios/lib/axios.js");const EntriesContext=(0,react__WEBPACK_IMPORTED_MODULE_1__.createContext)({data:[],setData:()=>{}}),{Provider}=EntriesContext;function useJournalEntries(){const{data,setData}=(0,react__WEBPACK_IMPORTED_MODULE_1__.useContext)(EntriesContext);return{data,setData}}},"./src/app/utils/hooks/use-tasks.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Ay:()=>useTasks,sF:()=>TasksContext});__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js");var react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js");__webpack_require__("./node_modules/axios/lib/axios.js"),__webpack_require__("./src/app/components/ui/use-toast.ts");const TasksContext=(0,react__WEBPACK_IMPORTED_MODULE_1__.createContext)({data:[],setData:()=>{},error:void 0,loading:!1}),{Provider}=TasksContext;function useTasks(){const{data,setData,loading}=(0,react__WEBPACK_IMPORTED_MODULE_1__.useContext)(TasksContext);return{data,setData,loading}}},"./src/app/utils/tasks/estimates.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{X:()=>addEstimates});const addEstimates=(acc,val)=>acc+(val.estimate||0)}}]);